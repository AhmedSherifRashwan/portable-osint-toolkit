{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-12">
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-body">
        <h5 class="card-title">
          <i class="fas fa-search text-info me-2"></i>Regex Search & Pattern Extraction
        </h5>
        <p class="card-text text-muted">
          Extract emails, phone numbers, cryptocurrency addresses, and custom patterns from text using regular expressions.
        </p>
        
        <form method="POST" class="mt-3">
          <div class="mb-3">
            <label for="text" class="form-label">Text to Search</label>
            <textarea name="text" id="text" class="form-control" rows="8" 
                      placeholder="Paste your text here to search for patterns..."
                      required>{{ request.form.text if request.form.text }}</textarea>
          </div>
          
          <div class="mb-3">
            <label for="search_type" class="form-label">Search Type</label>
            <select name="search_type" id="search_type" class="form-select" onchange="toggleCustomPattern()">
              <option value="emails" {{ 'selected' if request.form.search_type == 'emails' else '' }}>Email Addresses</option>
              <option value="phones" {{ 'selected' if request.form.search_type == 'phones' else '' }}>Phone Numbers</option>
              <option value="crypto" {{ 'selected' if request.form.search_type == 'crypto' else '' }}>Cryptocurrency Addresses</option>
              <option value="custom" {{ 'selected' if request.form.search_type == 'custom' else '' }}>Custom Regex Pattern</option>
            </select>
          </div>
          
          <div class="mb-3" id="customPatternDiv" style="display: none;">
            <label for="custom_pattern" class="form-label">Custom Regex Pattern</label>
            <input type="text" name="custom_pattern" id="custom_pattern" class="form-control" 
                   placeholder="Enter your regex pattern (e.g., \b\d{3}-\d{2}-\d{4}\b for SSN)"
                   value="{{ request.form.custom_pattern if request.form.custom_pattern }}">
            <div class="form-text">
              <i class="fas fa-info-circle me-1"></i>
              Use standard Python regex syntax. Be careful with special characters.
            </div>
          </div>
          
          <button class="btn btn-info" type="submit">
            <i class="fas fa-search me-1"></i>Search Patterns
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

{% if error %}
  <div class="alert alert-warning border-0" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
  </div>
{% endif %}

{% if results is not none %}
<div class="row">
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-header bg-info text-white">
        <h6 class="mb-0">
          <i class="fas fa-list me-2"></i>Search Results
          {% if request.form.search_type == 'emails' %}
            - Email Addresses
          {% elif request.form.search_type == 'phones' %}
            - Phone Numbers
          {% elif request.form.search_type == 'crypto' %}
            - Cryptocurrency Addresses
          {% elif request.form.search_type == 'custom' %}
            - Custom Pattern Matches
          {% endif %}
        </h6>
      </div>
      <div class="card-body">
        {% if request.form.search_type == 'crypto' and results %}
          <!-- Special handling for crypto addresses -->
          <div class="row">
            {% if results.bitcoin %}
            <div class="col-md-6 mb-3">
              <h6 class="text-warning">
                <i class="fab fa-bitcoin me-1"></i>Bitcoin Addresses
                <span class="badge bg-warning">{{ results.bitcoin|length }}</span>
              </h6>
              {% for addr in results.bitcoin %}
                <div class="mb-2">
                  <code class="d-block p-2 bg-light rounded">{{ addr }}</code>
                  <small class="text-muted">
                    <a href="https://blockchair.com/bitcoin/address/{{ addr }}" target="_blank" class="text-decoration-none">
                      <i class="fas fa-external-link-alt me-1"></i>View on Blockchair
                    </a>
                  </small>
                </div>
              {% endfor %}
            </div>
            {% endif %}
            
            {% if results.ethereum %}
            <div class="col-md-6 mb-3">
              <h6 class="text-primary">
                <i class="fab fa-ethereum me-1"></i>Ethereum Addresses
                <span class="badge bg-primary">{{ results.ethereum|length }}</span>
              </h6>
              {% for addr in results.ethereum %}
                <div class="mb-2">
                  <code class="d-block p-2 bg-light rounded">{{ addr }}</code>
                  <small class="text-muted">
                    <a href="https://etherscan.io/address/{{ addr }}" target="_blank" class="text-decoration-none">
                      <i class="fas fa-external-link-alt me-1"></i>View on Etherscan
                    </a>
                  </small>
                </div>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          
          {% if not results.bitcoin and not results.ethereum %}
            <div class="alert alert-info mb-0">
              <i class="fas fa-info-circle me-2"></i>No cryptocurrency addresses found in the provided text.
            </div>
          {% endif %}
        {% elif results %}
          <!-- Regular results display -->
          <div class="mb-3">
            <span class="badge bg-success">{{ results|length }} matches found</span>
          </div>
          
          {% if results|length > 0 %}
            <div class="row">
              {% for result in results %}
                <div class="col-md-6 col-lg-4 mb-2">
                  <code class="d-block p-2 bg-light rounded">{{ result }}</code>
                </div>
              {% endfor %}
            </div>
            
            <!-- Copy all results -->
            <div class="mt-3">
              <button class="btn btn-outline-secondary btn-sm" onclick="copyResults()">
                <i class="fas fa-copy me-1"></i>Copy All Results
              </button>
              <textarea id="resultsText" style="position: absolute; left: -9999px;">{% for result in results %}{{ result }}
{% endfor %}</textarea>
            </div>
          {% endif %}
        {% else %}
          <div class="alert alert-info mb-0">
            <i class="fas fa-info-circle me-2"></i>No matches found for the specified pattern.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- Pattern Examples -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-header bg-secondary text-white">
        <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Pattern Examples & Quick Tests</h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6>Sample Text for Testing</h6>
            <div class="alert alert-light">
              <small>
                <strong>Contact Information:</strong><br>
                Email: john.doe@example.com, support@company.org<br>
                Phone: (555) 123-4567, +1-800-555-0199<br>
                Bitcoin: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa<br>
                Ethereum: 0x742d35Cc6634C0532925a3b8D4C2C2C2C2C2C2C2<br>
                SSN: 123-45-6789<br>
                Credit Card: 4532-1234-5678-9012
              </small>
            </div>
            <button class="btn btn-outline-primary btn-sm" onclick="fillSampleText()">
              <i class="fas fa-fill me-1"></i>Use Sample Text
            </button>
          </div>
          
          <div class="col-md-6">
            <h6>Common Regex Patterns</h6>
            <table class="table table-sm">
              <tbody>
                <tr>
                  <th>SSN</th>
                  <td><code>\b\d{3}-\d{2}-\d{4}\b</code></td>
                </tr>
                <tr>
                  <th>Credit Card</th>
                  <td><code>\b\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}\b</code></td>
                </tr>
                <tr>
                  <th>IP Address</th>
                  <td><code>\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b</code></td>
                </tr>
                <tr>
                  <th>URL</th>
                  <td><code>https?://[^\s]+</code></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function toggleCustomPattern() {
  const searchType = document.getElementById('search_type').value;
  const customDiv = document.getElementById('customPatternDiv');
  
  if (searchType === 'custom') {
    customDiv.style.display = 'block';
  } else {
    customDiv.style.display = 'none';
  }
}

function fillSampleText() {
  const sampleText = `Contact Information:
Email: john.doe@example.com, support@company.org
Phone: (555) 123-4567, +1-800-555-0199
Bitcoin: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa
Ethereum: 0x742d35Cc6634C0532925a3b8D4C2C2C2C2C2C2C2
SSN: 123-45-6789
Credit Card: 4532-1234-5678-9012
Website: https://example.com
IP Address: 192.168.1.1`;
  
  document.getElementById('text').value = sampleText;
}

function copyResults() {
  const textarea = document.getElementById('resultsText');
  textarea.select();
  document.execCommand('copy');
  
  // Show feedback
  const btn = event.target;
  const originalText = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
  btn.classList.add('btn-success');
  btn.classList.remove('btn-outline-secondary');
  
  setTimeout(() => {
    btn.innerHTML = originalText;
    btn.classList.remove('btn-success');
    btn.classList.add('btn-outline-secondary');
  }, 2000);
}

// Initialize custom pattern visibility
document.addEventListener('DOMContentLoaded', function() {
  toggleCustomPattern();
});
</script>
{% endblock %}
