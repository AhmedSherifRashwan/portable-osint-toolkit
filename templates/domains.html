{% extends "base.html" %}
{% block content %}
<h1>Domains / Infrastructure</h1>

<form method="POST" class="mb-3">
  <div class="input-group">
    <input type="text" name="domain" class="form-control" placeholder="Enter domain (example.com)" required>
    <button class="btn btn-primary" type="submit">Lookup</button>
  </div>
</form>

{% if error %}
  <div class="alert alert-warning">{{ error }}</div>
{% endif %}

{% if whois_text %}
<div class="card p-3 mt-3">
  <h5>WHOIS Result</h5>
  <table class="table table-sm">
    <tbody>
      {% set w = whois_text %}
      {% if w.registrar %}<tr><th>Registrar</th><td>{{ w.registrar }}</td></tr>{% endif %}
      {% if w.creation_date %}<tr><th>Created</th><td>{{ w.creation_date }}</td></tr>{% endif %}
      {% if w.expiration_date %}<tr><th>Expires</th><td>{{ w.expiration_date }}</td></tr>{% endif %}
      {% if w.updated_date %}<tr><th>Updated</th><td>{{ w.updated_date }}</td></tr>{% endif %}
      {% if w.name_servers %}<tr><th>Name Servers</th><td>{{ w.name_servers }}</td></tr>{% endif %}
      {% if w.emails %}<tr><th>Email(s)</th><td>{{ w.emails }}</td></tr>{% endif %}
    </tbody>
  </table>

  <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#rawWhois">
    Show Raw WHOIS
  </button>
  <div id="rawWhois" class="collapse mt-2">
    <pre style="white-space: pre-wrap; font-size: .8rem;">{{ w }}</pre>
  </div>

  <!-- Export button -->
  <form action="{{ url_for('export_domains_pdf') }}" method="POST" target="_blank" class="mt-3">
    <input type="hidden" name="domain" value="{{ request.form.domain }}">
    <input type="hidden" name="whois_text" value="{{ whois_text }}">
    <input type="hidden" name="rdap_text" value="{{ rdap_result|tojson }}">
    <input type="hidden" name="subs_text" value="{{ subdomains_result|tojson }}">
    <button class="btn btn-success btn-sm" type="submit">ðŸ“„ Export as PDF</button>
  </form>
</div>
{% endif %}


{% if rdap_result %}
<div class="card p-3 mt-3">
  <h5>RDAP Result</h5>
  <table class="table table-sm table-striped">
    <tbody>
      {% if rdap_result.network %}
        <tr><th>IP</th><td>{{ rdap_result.query }}</td></tr>
        <tr><th>Network</th><td>{{ rdap_result.network.handle }} ({{ rdap_result.network.start_address }} - {{ rdap_result.network.end_address }})</td></tr>
        <tr><th>Name</th><td>{{ rdap_result.network.name }}</td></tr>
        <tr><th>Country</th><td>{{ rdap_result.network.country }}</td></tr>
      {% endif %}
      {% if rdap_result.asn %}
        <tr><th>ASN</th><td>{{ rdap_result.asn }} ({{ rdap_result.asn_description }})</td></tr>
      {% endif %}
    </tbody>
  </table>

  <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#rawRdap">
    Show Raw JSON
  </button>
  <div id="rawRdap" class="collapse mt-2">
    <pre style="white-space: pre-wrap; font-size: .8rem;">{{ rdap_result | tojson(indent=2) }}</pre>
  </div>
</div>
{% endif %}

{% if subdomains_result is not none %}
<div class="card p-3 mt-3">
  <h5>Subdomain Enumeration</h5>
  {% if subdomains_result|length == 0 %}
    <p class="mb-0">No subdomains found with the default wordlist.</p>
  {% else %}
    <table class="table table-sm table-bordered">
      <thead>
        <tr>
          <th>Subdomain</th>
          <th>Resolved IP(s)</th>
        </tr>
      </thead>
      <tbody>
        {% for s in subdomains_result %}
          <tr>
            <td>{{ s.subdomain }}</td>
            <td>{{ s.address }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>
{% endif %}
{% endblock %}
